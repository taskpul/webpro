import{P as F}from"./chunk-2LPGQWPV-BkUkeRJD.js";import{ap as N,e6 as L,aB as E,ar as A,b as P,ab as I,eu as M,et as k,j as e,H as D,aw as G,ax as H,Y as O,ey as B,t as S,W as r,cn as T,V as _,I as R,cI as z,B as C,Z as K,J as V,_ as J}from"./index-DdOSbXML.js";import"./chunk-7VJK6HNE-BEBSsUUt.js";import"./chunk-Z26G6WFJ-Bp9oejZG.js";import{K as U}from"./chunk-6HTZNHPT-XB1WuBsp.js";import{b as c,u as W,a as X,c as u}from"./chunk-4TC5YS65-CQLRrj-3.js";import"./chunk-ZJRFL6ZN-DxPzg2yg.js";import"./chunk-C76H5USB-VyJ6cqJ4.js";import"./chunk-MSDRGCRR-BdWcKAwE.js";import"./chunk-P3UUX2T6-B1b-Y827.js";import"./chunk-YEDAFXMB-BKFicqAc.js";import"./chunk-M3VFKDXJ-qonQG1d-.js";import"./chunk-AOFGTNG6-CkJBs9dj.js";import"./chunk-EMIHDNB7-CarGCoSL.js";import"./chunk-PFKKVLZX-BUfUd_n-.js";import"./_isIndex-Cj2VejAI.js";import"./index-B-otT4yT.js";var Y=N({ends_at:L().nullable(),starts_at:L().nullable(),customer_group_id:E(N({id:A(),name:A()}))}),w="cg",Z=({priceList:d,customerGroups:f})=>{const{t:s}=P(),{handleSuccess:x}=W(),{setIsOpen:p}=X(),n=G({defaultValues:{ends_at:d.ends_at?new Date(d.ends_at):null,starts_at:d.starts_at?new Date(d.starts_at):null,customer_group_id:f},resolver:H(Y)}),{fields:t,remove:m,append:g}=O({control:n.control,name:"customer_group_id",keyName:"cg_id"}),j=i=>{if(!i.length){n.setValue("customer_group_id",[]),p(w,!1);return}const o=i.map(a=>a.id),l=i.filter(a=>!t.some(h=>h.id===a.id));for(const a of t)o.includes(a.id)||m(t.indexOf(a));g(l),p(w,!1)},{mutateAsync:b}=B(d.id),y=n.handleSubmit(async i=>{var a,h;const o=i.customer_group_id.map(v=>v.id),l={...d.rules};o.length?l["customer.groups.id"]=o:delete l["customer.groups.id"],await b({starts_at:((a=i.starts_at)==null?void 0:a.toISOString())||null,ends_at:((h=i.ends_at)==null?void 0:h.toISOString())||null,rules:l},{onSuccess:()=>{S.success(s("priceLists.configuration.edit.successToast")),x()},onError:v=>S.error(v.message)})});return e.jsxs(c.Form,{form:n,children:[e.jsx(c.Description,{className:"sr-only",children:s("priceLists.configuration.edit.description")}),e.jsxs(U,{className:"flex flex-1 flex-col overflow-hidden",onSubmit:y,children:[e.jsxs(c.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-auto",children:[e.jsx(r.Field,{control:n.control,name:"starts_at",render:({field:i})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{optional:!0,children:s("priceLists.fields.startsAt.label")}),e.jsx(r.Hint,{children:s("priceLists.fields.startsAt.hint")})]}),e.jsx(r.Control,{children:e.jsx(T,{granularity:"minute",shouldCloseOnSelect:!1,...i})})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(_,{}),e.jsx(r.Field,{control:n.control,name:"ends_at",render:({field:i})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{optional:!0,children:s("priceLists.fields.endsAt.label")}),e.jsx(r.Hint,{children:s("priceLists.fields.endsAt.hint")})]}),e.jsx(r.Control,{children:e.jsx(T,{granularity:"minute",shouldCloseOnSelect:!1,...i})})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(_,{}),e.jsx(r.Field,{control:n.control,name:"customer_group_id",render:({field:i})=>e.jsxs(r.Item,{children:[e.jsxs("div",{children:[e.jsx(r.Label,{optional:!0,children:s("priceLists.fields.customerAvailability.label")}),e.jsx(r.Hint,{children:s("priceLists.fields.customerAvailability.hint")})]}),e.jsx(r.Control,{children:e.jsxs("div",{className:R("bg-ui-bg-component shadow-elevation-card-rest transition-fg grid gap-1.5 rounded-xl py-1.5","aria-[invalid='true']:shadow-borders-error"),role:"application",ref:i.ref,children:[e.jsxs("div",{className:"text-ui-fg-subtle grid gap-1.5 px-1.5 md:grid-cols-2",children:[e.jsx("div",{className:"bg-ui-bg-field shadow-borders-base txt-compact-small rounded-md px-2 py-1.5",children:s("priceLists.fields.customerAvailability.attribute")}),e.jsx("div",{className:"bg-ui-bg-field shadow-borders-base txt-compact-small rounded-md px-2 py-1.5",children:s("operators.in")})]}),e.jsx("div",{className:"flex items-center gap-1.5 px-1.5",children:e.jsxs(u,{id:w,children:[e.jsx(u.Trigger,{asChild:!0,children:e.jsxs("button",{type:"button",className:"bg-ui-bg-field shadow-borders-base txt-compact-small text-ui-fg-muted flex flex-1 items-center gap-x-2 rounded-md px-2 py-1.5",children:[e.jsx(z,{}),s("priceLists.fields.customerAvailability.placeholder")]})}),e.jsx(u.Trigger,{asChild:!0,children:e.jsx(C,{variant:"secondary",children:s("actions.browse")})}),e.jsxs(u.Content,{children:[e.jsxs(u.Header,{children:[e.jsx(u.Title,{asChild:!0,children:e.jsx(D,{children:s("priceLists.fields.customerAvailability.header")})}),e.jsx(u.Description,{className:"sr-only",children:s("priceLists.fields.customerAvailability.hint")})]}),e.jsx(F,{type:"drawer",setState:j,state:t})]})]})}),t.length>0?e.jsxs("div",{className:"flex flex-col gap-y-1.5",children:[e.jsx(_,{variant:"dashed"}),e.jsx("div",{className:"flex flex-col gap-y-1.5 px-1.5",children:t.map((o,l)=>e.jsxs("div",{className:"bg-ui-bg-field-component shadow-borders-base flex items-center justify-between gap-2 rounded-md px-2 py-0.5",children:[e.jsx(K,{size:"small",leading:"compact",children:o.name}),e.jsx(V,{size:"small",variant:"transparent",type:"button",onClick:()=>m(l),children:e.jsx(J,{})})]},o.cg_id))})]}):null]})}),e.jsx(r.ErrorMessage,{})]})})]}),e.jsx(c.Footer,{className:"shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(c.Close,{asChild:!0,children:e.jsx(C,{size:"small",variant:"secondary",children:s("actions.cancel")})}),e.jsx(C,{size:"small",type:"submit",children:s("actions.save")})]})})]})]})},pe=()=>{var l;const{t:d}=P(),{id:f}=I(),{price_list:s,isPending:x,isError:p,error:n}=M(f),t=(l=s==null?void 0:s.rules)==null?void 0:l["customer.groups.id"],{customer_groups:m,isPending:g,isError:j,error:b}=k({id:t},{enabled:!!(t!=null&&t.length)}),y=(m==null?void 0:m.map(a=>({id:a.id,name:a.name})))||[],i=x?!1:!(t!=null&&t.length&&g),o=!x&&!!s&&i;if(p)throw n;if(j)throw b;return e.jsxs(c,{children:[e.jsx(c.Header,{children:e.jsx(c.Title,{asChild:!0,children:e.jsx(D,{children:d("priceLists.configuration.edit.header")})})}),o&&e.jsx(Z,{priceList:s,customerGroups:y})]})};export{pe as Component};
