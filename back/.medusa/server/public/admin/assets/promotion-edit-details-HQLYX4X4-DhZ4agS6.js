import{D as B}from"./chunk-KEQOAJC2-Yj14g3dO.js";import{c as E,g as N}from"./chunk-DK4WIVY6-CYCbBMOO.js";import{S as I}from"./chunk-D7H6ZNK4-DuqkGbL3.js";import{K as T}from"./chunk-6HTZNHPT-XB1WuBsp.js";import{b as n,u as V}from"./chunk-4TC5YS65-CQLRrj-3.js";import{ap as w,ar as h,as as L,aq as p,aD as D,ab as P,b,e8 as M,j as e,H as R,aw as U,ax as z,N as y,e3 as H,r as K,W as t,X as W,Z as k,dS as q,B as _}from"./index-DdOSbXML.js";import{T as A}from"./Trans-vJDrnLfE.js";import{R as r}from"./radio-group-bYQ_4UAu.js";import"./index-B-otT4yT.js";var G=w({is_automatic:h().toLowerCase(),code:h().min(1),is_tax_inclusive:L().optional(),status:p(["active","inactive","draft"]),value_type:p(["fixed","percentage"]),value:D().min(0).or(h().min(1)),allocation:p(["each","across"]),target_type:p(["order","shipping_methods","items"])}),X=({promotion:a})=>{var v;const{t:o}=b(),{handleSuccess:m}=V(),i=U({defaultValues:{is_automatic:a.is_automatic.toString(),is_tax_inclusive:a.is_tax_inclusive,code:a.code,status:a.status,value:a.application_method.value,allocation:a.application_method.allocation,value_type:a.application_method.type,target_type:a.application_method.target_type},resolver:z(G)}),d=y({control:i.control,name:"value_type"})==="fixed",{mutateAsync:C,isPending:F}=H(a.id),S=i.handleSubmit(async s=>{const l=parseFloat(s.value);if(isNaN(l)||l<0){i.setError("value",{message:o("promotions.form.value.invalid")});return}await C({is_automatic:s.is_automatic==="true",code:s.code,status:s.status,is_tax_inclusive:s.is_tax_inclusive,application_method:{value:parseFloat(s.value),type:s.value_type,allocation:s.allocation}},{onSuccess:()=>{m()}})}),x=y({control:i.control,name:"value_type"});return K.useEffect(()=>{x==="fixed"&&a.type==="standard"||i.setValue("is_tax_inclusive",!1)},[x,i,a]),e.jsx(n.Form,{form:i,children:e.jsxs(T,{onSubmit:S,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(n.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-y-auto",children:e.jsxs("div",{className:"flex flex-col gap-y-8",children:[e.jsx(t.Field,{control:i.control,name:"status",render:({field:s})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o("promotions.form.status.label")}),e.jsx(t.Control,{children:e.jsxs(r,{className:"flex-col gap-y-3",...s,value:s.value,onValueChange:s.onChange,children:[e.jsx(r.ChoiceBox,{value:"draft",label:o("promotions.form.status.draft.title"),description:o("promotions.form.status.draft.description")}),e.jsx(r.ChoiceBox,{value:"active",label:o("promotions.form.status.active.title"),description:o("promotions.form.status.active.description")}),e.jsx(r.ChoiceBox,{value:"inactive",label:o("promotions.form.status.inactive.title"),description:o("promotions.form.status.inactive.description")})]})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:i.control,name:"is_automatic",render:({field:s})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o("promotions.form.method.label")}),e.jsx(t.Control,{children:e.jsxs(r,{className:"flex-col gap-y-3",...s,value:s.value,onValueChange:s.onChange,children:[e.jsx(r.ChoiceBox,{value:"false",label:o("promotions.form.method.code.title"),description:o("promotions.form.method.code.description")}),e.jsx(r.ChoiceBox,{value:"true",label:o("promotions.form.method.automatic.title"),description:o("promotions.form.method.automatic.description")})]})}),e.jsx(t.ErrorMessage,{})]})}),x==="fixed"&&a.type==="standard"&&e.jsx(I,{control:i.control,name:"is_tax_inclusive",label:o("promotions.form.taxInclusive.title"),description:o("promotions.form.taxInclusive.description")}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(t.Field,{control:i.control,name:"code",render:({field:s})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o("promotions.form.code.title")}),e.jsx(t.Control,{children:e.jsx(W,{...s})})]})}),e.jsx(k,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(A,{t:o,i18nKey:"promotions.form.code.description",components:[e.jsx("br",{},"break")]})})]}),((v=a.application_method)==null?void 0:v.target_type)!=="shipping_methods"&&e.jsxs(e.Fragment,{children:[e.jsx(t.Field,{control:i.control,name:"value_type",render:({field:s})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o("promotions.fields.value_type")}),e.jsx(t.Control,{children:e.jsxs(r,{className:"flex-col gap-y-3",...s,onValueChange:s.onChange,children:[e.jsx(r.ChoiceBox,{value:"fixed",label:o("promotions.form.value_type.fixed.title"),description:o("promotions.form.value_type.fixed.description")}),e.jsx(r.ChoiceBox,{value:"percentage",label:o("promotions.form.value_type.percentage.title"),description:o("promotions.form.value_type.percentage.description")})]})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:i.control,name:"value",render:({field:{onChange:s,...l}})=>{var g;const c=((g=a.application_method)==null?void 0:g.currency_code)??"USD",j=E[(c==null?void 0:c.toUpperCase())||"USD"];return e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o(d?"fields.amount":"fields.percentage")}),e.jsx(t.Control,{children:d?e.jsx(q,{min:0,onValueChange:u=>s(u),decimalSeparator:".",groupSeparator:",",decimalScale:j.decimal_digits,decimalsLimit:j.decimal_digits,code:c,symbol:N(c),...l,value:l.value}):e.jsx(B,{min:0,max:100,...l,value:l.value||"",onChange:u=>{s(u.target.value===""?null:parseFloat(u.target.value))}},"amount")}),e.jsx(t.ErrorMessage,{})]})}}),e.jsx(t.Field,{control:i.control,name:"allocation",render:({field:s})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o("promotions.fields.allocation")}),e.jsx(t.Control,{children:e.jsxs(r,{className:"flex-col gap-y-3",...s,onValueChange:s.onChange,children:[e.jsx(r.ChoiceBox,{value:"each",label:o("promotions.form.allocation.each.title"),description:o("promotions.form.allocation.each.description")}),e.jsx(r.ChoiceBox,{value:"across",label:o("promotions.form.allocation.across.title"),description:o("promotions.form.allocation.across.description")})]})}),e.jsx(t.ErrorMessage,{})]})})]})]})}),e.jsx(n.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(n.Close,{asChild:!0,children:e.jsx(_,{size:"small",variant:"secondary",children:o("actions.cancel")})}),e.jsx(_,{size:"small",type:"submit",isLoading:F,children:o("actions.save")})]})})]})})},se=()=>{const{id:a}=P(),{t:o}=b(),{promotion:m,isLoading:i,isError:f,error:d}=M(a);if(f)throw d;return e.jsxs(n,{children:[e.jsx(n.Header,{children:e.jsx(R,{children:o("promotions.edit.title")})}),!i&&m&&e.jsx(X,{promotion:m})]})};export{se as Component};
