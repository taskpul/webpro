import{u as W,a as Z,b as $}from"./chunk-NOAFLTPV-CW7dX9LN.js";import{f as q}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{u as G,_ as Q}from"./chunk-7VJK6HNE-BEBSsUUt.js";import{ap as w,ar as p,as as N,aB as R,v as U,j as e,r as F,aw as J,ax as Y,N as ee,b as se,f1 as re,t as T,dF as k,I as ie,H as ae,Z as g,W as r,X as ne,at as f,az as I,B as x,a3 as P,a1 as te,i as le}from"./index-DdOSbXML.js";import{C as oe}from"./chunk-2PMSBTXI-B-DQ21hS.js";import{c as ce}from"./chunk-DK4WIVY6-CYCbBMOO.js";import"./chunk-Z26G6WFJ-Bp9oejZG.js";import{K as de}from"./chunk-6HTZNHPT-XB1WuBsp.js";import{R as h,a as ue,u as me,S as m}from"./chunk-4TC5YS65-CQLRrj-3.js";import{b as xe}from"./chunk-ZCZL3STK-Cebcr_on.js";import"./chunk-C76H5USB-VyJ6cqJ4.js";import"./chunk-YEDAFXMB-BKFicqAc.js";import"./chunk-M3VFKDXJ-qonQG1d-.js";import"./chunk-AOFGTNG6-CkJBs9dj.js";import"./chunk-EMIHDNB7-CarGCoSL.js";import"./chunk-PFKKVLZX-BUfUd_n-.js";import"./_isIndex-Cj2VejAI.js";import"./index-B-otT4yT.js";var he=w({name:p().min(1),currency_code:p().min(2,"Select a currency"),automatic_taxes:N(),is_tax_inclusive:N(),countries:R(w({code:p(),name:p()})),payment_providers:R(p()).min(1)}),b="cr",C=50,z="countries-modal",je=({currencies:l,paymentProviders:n})=>{const{setIsOpen:u}=ue(),[c,j]=F.useState({}),{handleSuccess:v}=me(),t=J({defaultValues:{name:"",currency_code:"",automatic_taxes:!0,is_tax_inclusive:!1,countries:[],payment_providers:[]},resolver:Y(he)}),y=ee({control:t.control,name:"countries",defaultValue:[]}),{t:a}=se(),{mutateAsync:E,isPending:H}=re(),M=t.handleSubmit(async s=>{await E({name:s.name,countries:s.countries.map(i=>i.code),currency_code:s.currency_code,payment_providers:s.payment_providers,automatic_taxes:s.automatic_taxes,is_tax_inclusive:s.is_tax_inclusive},{onSuccess:({region:i})=>{T.success(a("regions.toast.create")),v(`../${i.id}`)},onError:i=>{T.error(i.message)}})}),{searchParams:D,raw:L}=W({pageSize:C,prefix:b}),{countries:A,count:_}=Z({countries:k.map((s,i)=>({display_name:s.display_name,name:s.name,id:i,iso_2:s.iso_2,iso_3:s.iso_3,num_code:s.num_code,region_id:null,region:{}})),...D}),S=ge(),{table:V}=G({data:A||[],columns:S,count:_,enablePagination:!0,enableRowSelection:!0,rowSelection:{state:c,updater:j},getRowId:s=>s.iso_2,pageSize:C,prefix:b}),B=()=>{const s=Object.keys(c).filter(i=>c[i]);t.setValue("countries",s.map(i=>({code:i,name:k.find(d=>d.iso_2===i).display_name})),{shouldDirty:!0,shouldTouch:!0}),u(z,!1)},O=s=>{const i=y.filter(o=>o.code!==s),d=i.map(o=>o.code).reduce((o,X)=>(o[X]=!0,o),{});t.setValue("countries",i,{shouldDirty:!0,shouldTouch:!0}),j(d)},K=()=>{t.setValue("countries",[],{shouldDirty:!0,shouldTouch:!0}),j({})};return e.jsx(h.Form,{form:t,children:e.jsxs(de,{className:"flex h-full flex-col overflow-hidden",onSubmit:M,children:[e.jsx(h.Header,{}),e.jsx(h.Body,{className:"flex overflow-hidden",children:e.jsx("div",{className:ie("flex h-full w-full flex-col items-center overflow-y-auto p-16"),id:"form-section",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsxs("div",{children:[e.jsx(ae,{children:a("regions.createRegion")}),e.jsx(g,{size:"small",className:"text-ui-fg-subtle",children:a("regions.createRegionHint")})]}),e.jsx("div",{className:"flex flex-col gap-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(r.Field,{control:t.control,name:"name",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:a("fields.name")}),e.jsx(r.Control,{children:e.jsx(ne,{...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:t.control,name:"currency_code",render:({field:{onChange:s,ref:i,...d}})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:a("fields.currency")}),e.jsx(r.Control,{children:e.jsxs(f,{...d,onValueChange:s,children:[e.jsx(f.Trigger,{ref:i,children:e.jsx(f.Value,{})}),e.jsx(f.Content,{children:l.map(o=>e.jsx(f.Item,{value:o.code,children:o.name},o.code))})]})}),e.jsx(r.ErrorMessage,{})]})})]})}),e.jsx(r.Field,{control:t.control,name:"automatic_taxes",render:({field:{value:s,onChange:i,...d}})=>e.jsx(r.Item,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(r.Label,{children:a("fields.automaticTaxes")}),e.jsx(r.Control,{children:e.jsx(I,{...d,checked:s,onCheckedChange:i})})]}),e.jsx(r.Hint,{children:a("regions.automaticTaxesHint")}),e.jsx(r.ErrorMessage,{})]})})}),e.jsx(r.Field,{control:t.control,name:"is_tax_inclusive",render:({field:{value:s,onChange:i,...d}})=>e.jsx(r.Item,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(r.Label,{children:a("fields.taxInclusivePricing")}),e.jsx(r.Control,{children:e.jsx(I,{...d,checked:s,onCheckedChange:i})})]}),e.jsx(r.Hint,{children:a("regions.taxInclusiveHint")}),e.jsx(r.ErrorMessage,{})]})})}),e.jsx("div",{className:"bg-ui-border-base h-px w-full"}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{size:"small",leading:"compact",weight:"plus",children:a("fields.countries")}),e.jsx(g,{size:"small",className:"text-ui-fg-subtle",children:a("regions.countriesHint")})]}),y.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[y.map(s=>e.jsx(fe,{country:s,onRemove:O},s.code)),e.jsx(x,{variant:"transparent",size:"small",className:"text-ui-fg-muted hover:text-ui-fg-subtle",onClick:K,children:a("actions.clearAll")})]}),e.jsxs(m,{id:z,children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(m.Trigger,{asChild:!0,children:e.jsx(x,{variant:"secondary",size:"small",children:a("regions.addCountries")})})}),e.jsx(m.Content,{children:e.jsxs("div",{className:"flex size-full flex-col overflow-hidden",children:[e.jsx(m.Header,{children:e.jsx(m.Title,{asChild:!0,children:e.jsx("span",{className:"sr-only",children:a("regions.addCountries")})})}),e.jsx(m.Body,{className:"overflow-hidden",children:e.jsx(Q,{table:V,columns:S,count:_,pageSize:C,orderBy:[{key:"display_name",label:a("fields.name")},{key:"iso_2",label:a("fields.code")}],pagination:!0,search:"autofocus",layout:"fill",queryObject:L,prefix:b})}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(x,{variant:"secondary",size:"small",children:a("actions.cancel")})}),e.jsx(x,{size:"small",type:"button",onClick:B,children:a("actions.save")})]})})]})})]})]}),e.jsx("div",{className:"bg-ui-border-base h-px w-full"}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{size:"small",leading:"compact",weight:"plus",children:a("fields.providers")}),e.jsx(g,{size:"small",className:"text-ui-fg-subtle",children:a("regions.providersHint")})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:e.jsx(r.Field,{control:t.control,name:"payment_providers",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:a("fields.paymentProviders")}),e.jsx(r.Control,{children:e.jsx(oe,{options:n.map(i=>({label:q(i.id),value:i.id})),...s})}),e.jsx(r.ErrorMessage,{})]})})})]})]})})}),e.jsxs(h.Footer,{children:[e.jsx(h.Close,{asChild:!0,children:e.jsx(x,{size:"small",variant:"secondary",children:a("actions.cancel")})}),e.jsx(x,{size:"small",type:"submit",isLoading:H,children:a("actions.save")})]})]})})},pe=le(),ge=()=>{const l=$();return F.useMemo(()=>[pe.display({id:"select",header:({table:n})=>e.jsx(P,{checked:n.getIsSomePageRowsSelected()?"indeterminate":n.getIsAllPageRowsSelected(),onCheckedChange:u=>n.toggleAllPageRowsSelected(!!u)}),cell:({row:n})=>{const u=!n.getCanSelect();return e.jsx(P,{checked:n.getIsSelected()||u,disabled:u,onCheckedChange:c=>n.toggleSelected(!!c),onClick:c=>{c.stopPropagation()}})}}),...l],[l])},fe=({country:l,onRemove:n})=>e.jsxs("div",{className:"bg-ui-bg-field shadow-borders-base transition-fg hover:bg-ui-bg-field-hover flex h-7 items-center overflow-hidden rounded-md",children:[e.jsx("div",{className:"txt-compact-small-plus flex h-full select-none items-center justify-center px-2 py-0.5",children:l.name}),e.jsx("button",{type:"button",onClick:()=>n(l.code),className:"focus-visible:bg-ui-bg-field-hover transition-fg hover:bg-ui-bg-field-hover flex h-full w-7 items-center justify-center border-l outline-none",children:e.jsx(te,{className:"text-ui-fg-muted"})})]}),De=()=>{const{store:l,isPending:n,isError:u,error:c}=U(),j=((l==null?void 0:l.supported_currencies)??[]).map(t=>ce[t.currency_code.toUpperCase()]),{payment_providers:v=[]}=xe({is_enabled:!0});if(u)throw c;return e.jsx(h,{children:!n&&l&&e.jsx(je,{currencies:j,paymentProviders:v})})};export{De as Component};
