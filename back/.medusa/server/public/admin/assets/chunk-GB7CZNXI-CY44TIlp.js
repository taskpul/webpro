import{D as oe,T as le}from"./chunk-3I6G3NRU-eRCqUyv2.js";import{D as ue}from"./chunk-SJ3E4T6B-CaDQoSV2.js";import{M as ce}from"./chunk-INE2QCSC-DBF9tbZr.js";import{P as de,S as fe,C as ge,V as _e}from"./chunk-XLDQPLK4-B7w1q8an.js";import{P as me}from"./chunk-IQBAUTU5-BEEkaJYn.js";import{D as he,S as ye,u as pe,a as be}from"./chunk-UNM3LPTG-C-e2J3tW.js";import{u as Ce}from"./chunk-C76H5USB-VyJ6cqJ4.js";import{j as c,ad as Se,ai as G,bA as ve,af as je,b as W,r as p,B as X,C as xe,g as Ae,bB as $,bC as De,d as Oe,an as Ne,bD as Ee,a5 as Re}from"./index-DdOSbXML.js";import{R as Te}from"./react-country-flag.esm-BcOmqiZW.js";var we=({isDefaultView:e,currentViewId:t,currentViewName:r,onSaveAsDefault:i,onUpdateExisting:n,onSaveAsNew:s})=>{const{t:a}=W(),f=Ae(),u=async()=>{await f({title:a("views.prompts.updateDefault.title"),description:a("views.prompts.updateDefault.description"),confirmText:a("views.prompts.updateDefault.confirmText"),cancelText:a("views.prompts.updateDefault.cancelText")})&&i()},x=async()=>{await f({title:a("views.prompts.updateView.title"),description:a("views.prompts.updateView.description",{name:r}),confirmText:a("views.prompts.updateView.confirmText"),cancelText:a("views.prompts.updateView.cancelText")})&&n()};return c.jsxs($,{children:[c.jsx($.Trigger,{asChild:!0,children:c.jsxs(X,{variant:"secondary",size:"small",type:"button",children:[a("views.save"),c.jsx(De,{})]})}),c.jsx($.Content,{align:"end",children:e?c.jsxs(c.Fragment,{children:[c.jsx($.Item,{onClick:u,children:a("views.updateDefaultForEveryone")}),c.jsx($.Item,{onClick:s,children:a("views.saveAsNew")})]}):c.jsxs(c.Fragment,{children:[c.jsx($.Item,{onClick:x,children:a("views.updateViewName")}),c.jsx($.Item,{onClick:s,children:a("views.saveAsNew")})]})})]})};function Fe(e,t){const[r,i]=p.useState(()=>{if(e!=null&&e.length&&(t!=null&&t.configuration)){const o={};return e.forEach(l=>{var g;o[l.field]=((g=t.configuration.visible_columns)==null?void 0:g.includes(l.field))||!1}),o}else if(e!=null&&e.length)return z(e);return{}}),[n,s]=p.useState(()=>{var o;return(o=t==null?void 0:t.configuration)!=null&&o.column_order?t.configuration.column_order:e!=null&&e.length?J(e):[]}),a=p.useMemo(()=>({visibility:r,order:n}),[r,n]),f=p.useMemo(()=>({visible:Object.entries(r).filter(([l,g])=>g).map(([l])=>l),order:n}),[r,n]),u=p.useCallback(o=>{i(o)},[]),x=p.useCallback((o,l)=>{if(o!=null&&o.configuration){const g={};l.forEach(v=>{var S;g[v.field]=((S=o.configuration.visible_columns)==null?void 0:S.includes(v.field))||!1}),i(g),s(o.configuration.column_order||[])}else i(z(l)),s(J(l))},[]),m=p.useCallback(o=>{Object.keys(r).length===0&&i(z(o)),n.length===0&&s(J(o))},[]),C=p.useRef();return p.useEffect(()=>{var o,l,g;if(e!=null&&e.length){const v=((o=C.current)==null?void 0:o.id)!==(t==null?void 0:t.id),S=t&&((l=C.current)==null?void 0:l.id)===t.id&&C.current.updated_at!==t.updated_at;if(v||S)if(t!=null&&t.configuration){const h={};e.forEach(T=>{var O,w;h[T.field]=((w=(O=t.configuration)==null?void 0:O.visible_columns)==null?void 0:w.includes(T.field))||!1}),i(h),s(((g=t.configuration)==null?void 0:g.column_order)||[])}else i(z(e)),s(J(e))}C.current=t},[t,e]),{visibleColumns:r,columnOrder:n,columnState:a,currentColumns:f,setVisibleColumns:i,setColumnOrder:s,handleColumnVisibilityChange:u,handleViewChange:x,initializeColumns:m}}var K=500;function z(e){if(!e||e.length===0)return{};const t={};return e.forEach(r=>{t[r.field]=r.default_visible??!0}),t}function J(e){return!e||e.length===0?[]:[...e].sort((r,i)=>{const n=r.default_order??K,s=i.default_order??K;return n-s}).map(r=>r.field)}var Q={orders:{properties:["id","status","created_at","email","display_id","payment_status","fulfillment_status","total","currency_code"],relations:["*customer","*sales_channel"]},products:{properties:["id","title","handle","status","thumbnail"],relations:["collection.title","*sales_channels","*variants"]},customers:{properties:["id","email","first_name","last_name","created_at","updated_at","has_account"],relations:["*groups"]},inventory:{properties:["id","sku","title","description","stocked_quantity","reserved_quantity","created_at","updated_at"],relations:["*location_levels"]},default:{properties:["id","created_at","updated_at"],relations:[]}};function $e(e){const t=Q[e]||Q.default;return{properties:t.properties,relations:t.relations,formatted:[...t.properties,...t.relations].join(",")}}function ke(e,t,r){const i=$e(e),n=i.formatted;if(!(t!=null&&t.length))return n;const s=t.filter(l=>Object.keys(r).length>0?r[l.field]===!0:l.default_visible),a=new Set;s.forEach(l=>{var g,v;l.computed?((g=l.computed.required_fields)==null||g.forEach(S=>a.add(S)),(v=l.computed.optional_fields)==null||v.forEach(S=>a.add(S))):(l.field.includes("."),a.add(l.field))});const f=Array.from(a),u=f.filter(l=>l.includes(".")),x=f.filter(l=>!l.includes(".")),m=u.filter(l=>{const[g]=l.split(".");return!i.relations.some(S=>S===`*${g}`||S===g)}),C=x.filter(l=>!i.properties.includes(l)),o=[...m,...C];return o.length>0?`${n},${o.join(",")}`:n}function Ie(e){return e.startsWith("-")?{id:e.slice(1),desc:!0}:{id:e,desc:!1}}function Me({entity:e,queryPrefix:t="",filters:r=[]}){const i=Oe("view_configurations"),[n,s]=Ne(),{activeView:a,createView:f}=pe(e),u=(a==null?void 0:a.view_configuration)||null,{updateView:x}=be(e,(u==null?void 0:u.id)||""),{columns:m,isLoading:C}=Ee(e,{enabled:i}),o=Ce(["q","order",...r.map(_=>_.id)],t),{visibleColumns:l,columnOrder:g,currentColumns:v,setColumnOrder:S,handleColumnVisibilityChange:h,handleViewChange:T}=Fe(m,u);p.useEffect(()=>{m&&(T(u,m),s(_=>{if(Array.from(_.keys()).filter(d=>d.startsWith(t+"_")||d===t+"_q"||d===t+"_order").forEach(d=>_.delete(d)),u){const d=u.configuration;if(d.filters&&Object.entries(d.filters).forEach(([D,j])=>{_.set(`${t}_${D}`,JSON.stringify(j))}),d.sorting){const D=d.sorting.desc?`-${d.sorting.id}`:d.sorting.id;_.set(`${t}_order`,D)}d.search&&_.set(`${t}_q`,d.search)}return _}))},[u,m]);const O=p.useMemo(()=>{const _={};return r.forEach(y=>{o[y.id]!==void 0&&(_[y.id]=JSON.parse(o[y.id]||""))}),{filters:_,sorting:o.order?Ie(o.order):null,search:o.q||""}},[r,o]),[w,L]=p.useState(!1),M=p.useMemo(()=>{const _=O.filters,y=O.sorting,d=O.search,D=Object.entries(l).filter(([j,E])=>E).map(([j])=>j).sort();if(u){const j=u.configuration.filters||{},E=u.configuration.sorting,k=u.configuration.search||"",A=[...u.configuration.visible_columns||[]].sort(),R=u.configuration.column_order||[],q=new Set([...Object.keys(_),...Object.keys(j)]);for(const V of q)if(JSON.stringify(_[V])!==JSON.stringify(j[V]))return!0;const F=y||void 0,B=E||void 0;if(JSON.stringify(F)!==JSON.stringify(B)||d!==k||JSON.stringify(D)!==JSON.stringify(A)||JSON.stringify(g)!==JSON.stringify(R))return!0}else{if(Object.keys(_).length>0||y!==null||d!=="")return!0;if(m){const j=new Set(D),E=new Set(m.filter(A=>A.default_visible).map(A=>A.field));if(j.size!==E.size||[...j].some(A=>!E.has(A)))return!0;const k=m.sort((A,R)=>(A.default_order??500)-(R.default_order??500)).map(A=>A.field);if(JSON.stringify(g)!==JSON.stringify(k))return!0}}return!1},[u,l,g,O,m]);p.useEffect(()=>{const _=setTimeout(()=>{L(M)},50);return()=>clearTimeout(_)},[M]);const N=p.useCallback(()=>{m&&T(u,m),s(_=>{if(Array.from(_.keys()).filter(d=>d.startsWith(t+"_")||d===t+"_q"||d===t+"_order").forEach(d=>_.delete(d)),u!=null&&u.configuration){const d=u.configuration;if(d.filters&&Object.entries(d.filters).forEach(([D,j])=>{_.set(`${t}_${D}`,JSON.stringify(j))}),d.sorting){const D=d.sorting.desc?`-${d.sorting.id}`:d.sorting.id;_.set(`${t}_order`,D)}d.search&&_.set(`${t}_q`,d.search)}return _})},[u,m,t]),U=p.useMemo(()=>ke(e,m,l),[e,m,l]);return{activeView:u,createView:f,updateView:x,isViewConfigEnabled:i,visibleColumns:l,columnOrder:g,currentColumns:v,setColumnOrder:S,handleColumnVisibilityChange:h,currentConfiguration:O,hasConfigurationChanged:w,handleClearConfiguration:N,apiColumns:m,isLoadingColumns:C,queryParams:o,requiredFields:U}}var b=new Map,Ve=(e,t)=>t.split(".").reduce((r,i)=>r==null?void 0:r[i],e),P=(e,t,r,i)=>e==null?"-":String(e),ze=(e,t,r,i)=>{const n=e||[],s=Array.isArray(n)?n.length:0;return i("general.items",{count:s})},Z=(e,t,r,i)=>{if(!e)return"-";if(r.field==="status"&&t.status&&(t.handle||t.is_giftcard!==void 0))return c.jsx(de,{status:t.status});const n=f=>{switch(f==null?void 0:f.toLowerCase()){case"active":case"published":case"fulfilled":case"paid":return"green";case"pending":case"proposed":case"processing":return"orange";case"draft":return"grey";case"rejected":case"failed":case"canceled":return"red";default:return"grey"}},a=(f=>{if(!i)return f;const u=f.toLowerCase();switch(u){case"active":return i("general.active","Active");case"published":return i("products.productStatus.published","Published");case"draft":return i("orders.status.draft","Draft");case"pending":return i("orders.status.pending","Pending");case"canceled":return i("orders.status.canceled","Canceled");default:return i(`status.${u}`,f)}})(e);return c.jsx(Se,{color:n(e),children:a})},ee=(e,t,r,i)=>{if(r.field==="sales_channels_display"||r.field==="sales_channels")return c.jsx(fe,{salesChannels:t.sales_channels});if(!Array.isArray(e))return"-";const n=e.slice(0,2),s=e.length-2;return c.jsxs("div",{className:"flex gap-1",children:[n.map((a,f)=>c.jsx(G,{size:"xsmall",children:typeof a=="string"?a:a.name||a.title||"-"},f)),s>0&&c.jsx(G,{size:"xsmall",color:"grey",children:i?i("general.plusCountMore","+ {{count}} more",{count:s}):`+${s}`})]})},Je=(e,t,r,i)=>c.jsx(me,{product:t}),Le=(e,t,r,i)=>c.jsx(ge,{collection:t.collection}),Ue=(e,t,r,i)=>c.jsx(_e,{variants:t.variants}),qe=(e,t,r,i)=>{var n,s,a,f;if((n=t.customer)!=null&&n.first_name||(s=t.customer)!=null&&s.last_name){const u=`${t.customer.first_name||""} ${t.customer.last_name||""}`.trim();if(u)return u}return(a=t.customer)!=null&&a.email?t.customer.email:(f=t.customer)!=null&&f.phone?t.customer.phone:i?i("customers.guest","Guest"):"Guest"},Be=(e,t,r,i)=>{let n=null;if(r.field==="shipping_address_display"?n=t.shipping_address:r.field==="billing_address_display"?n=t.billing_address:n=t.shipping_address||t.billing_address,!n)return"-";const s=[];n.address_1&&s.push(n.address_1);const a=[];return n.city&&a.push(n.city),n.province&&a.push(n.province),n.postal_code&&a.push(n.postal_code),a.length>0&&s.push(a.join(", ")),n.country_code&&s.push(n.country_code.toUpperCase()),s.join(" â€¢ ")||"-"},He=(e,t,r,i)=>{var f;const n=(f=t.shipping_address)==null?void 0:f.country_code;if(!n)return c.jsx("div",{className:"flex w-full justify-center",children:"-"});const s=ve(n),a=(s==null?void 0:s.display_name)||n.toUpperCase();return c.jsx("div",{className:"flex w-full items-center justify-center",children:c.jsx(je,{content:a,children:c.jsx("div",{className:"flex size-4 items-center justify-center overflow-hidden rounded-sm",children:c.jsx(Te,{countryCode:n.toUpperCase(),svg:!0,style:{width:"16px",height:"16px"},"aria-label":a})})})})},Y=(e,t,r,i)=>c.jsx(ue,{date:e}),Pe=(e,t,r,i)=>c.jsx(oe,{displayId:e}),te=(e,t,r,i)=>{const n=t.currency_code||"USD";return c.jsx(ce,{currencyCode:n,amount:e,align:"right"})},We=(e,t,r,i)=>{const n=t.currency_code||"USD";return c.jsx(le,{currencyCode:n,total:e})};b.set("text",P);b.set("count",ze);b.set("status",Z);b.set("badge_list",ee);b.set("date",Y);b.set("timestamp",Y);b.set("currency",te);b.set("total",We);b.set("product_info",Je);b.set("collection",Le);b.set("variants",Ue);b.set("sales_channels_list",ee);b.set("customer_name",qe);b.set("address_summary",Be);b.set("country_code",He);b.set("display_id",Pe);function Ye(e,t){if(e&&b.has(e))return b.get(e);switch(t){case"number":case"string":return P;case"date":return Y;case"boolean":return(r,i,n,s)=>s?r?s("fields.yes","Yes"):s("fields.no","No"):r?"Yes":"No";case"enum":return Z;case"currency":return te;default:return P}}function Ge(e,t){return t.computed?e:Ve(e,t.field)}function Ke(e,t,r){const i=Re(),{t:n}=W();return p.useMemo(()=>t!=null&&t.length?t.map(s=>{var m;let a=(m=s.computed)==null?void 0:m.type;a||(s.semantic_type==="timestamp"?a="timestamp":s.field==="display_id"?a="display_id":s.field==="total"?a="total":s.semantic_type==="currency"&&(a="currency"));const f=Ye(a,s.data_type),u=r!=null&&r.getColumnAlignment?r.getColumnAlignment(s):Qe(s),x=C=>Ge(C,s);return i.accessor(x,{id:s.field,header:()=>s.name,cell:({getValue:C,row:o})=>{const l=C();if(r!=null&&r.transformCellValue){const g=r.transformCellValue(l,o.original,s);if(g!==null)return g}return f(l,o.original,s,n)},meta:{name:s.name,column:s},enableHiding:s.hideable,enableSorting:!1,headerAlign:u})}):[],[e,t,r,n])}function Qe(e){var t;return e.semantic_type==="currency"||e.data_type==="currency"||e.data_type==="number"&&e.context!=="identifier"||e.field.includes("total")||e.field.includes("amount")||e.field.includes("price")||e.field.includes("quantity")||e.field.includes("count")?"right":e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="country_code"||e.field==="country"||e.field.includes("country_code")?"center":"left"}var Xe={getColumnAlignment:e=>{var t;return e.semantic_type==="currency"?"right":e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="country_code"?"center":"left"}},Ze={getColumnAlignment:e=>{var t,r,i;return e.field==="product_display"||e.field==="collection.title"||e.field==="sales_channels_display"||e.field==="variants_count"?"left":e.field==="sku"?"center":e.field==="stock"||e.semantic_type==="currency"?"right":(e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="product_info"||((r=e.computed)==null?void 0:r.type)==="count"||((i=e.computed)==null?void 0:i.type)==="sales_channels_list","left")},transformCellValue:(e,t,r)=>{var i,n,s;if(r.field==="variants_count"||((i=r.computed)==null?void 0:i.type)==="count"){const a=Array.isArray(t.variants)?t.variants.length:0;return`${a} ${a===1?"variant":"variants"}`}return r.field==="product_display"||((n=r.computed)==null?void 0:n.type)==="product_info"||r.field==="sales_channels_display"||((s=r.computed)==null?void 0:s.type)==="sales_channels_list"||r.field==="status",null}},et={getColumnAlignment:e=>e.field==="orders_count"||e.semantic_type==="currency"?"right":e.semantic_type==="status"?"center":"left",transformCellValue:(e,t,r)=>{if(r.field==="name"){const{first_name:i,last_name:n}=t;return i||n?`${i||""} ${n||""}`.trim():"-"}return null}},tt={getColumnAlignment:e=>e.field==="stocked_quantity"||e.field==="reserved_quantity"||e.field==="available_quantity"?"right":e.semantic_type==="status"?"center":"left"},rt={orders:Xe,products:Ze,customers:et,inventory:tt};function nt(e){return rt[e]}function gt({adapter:e,heading:t,subHeading:r,pageSize:i,queryPrefix:n,layout:s="fill",actions:a}){const{t:f}=W(),[u,x]=p.useState(!1),[m,C]=p.useState(null),o=e.entity,l=e.entityName,g=e.filters||[],v=i||e.pageSize||20,S=n||e.queryPrefix||"",{activeView:h,createView:T,updateView:O,isViewConfigEnabled:w,visibleColumns:L,columnOrder:M,currentColumns:N,setColumnOrder:U,handleColumnVisibilityChange:_,currentConfiguration:y,hasConfigurationChanged:d,handleClearConfiguration:D,isLoadingColumns:j,apiColumns:E,requiredFields:k,queryParams:A}=Me({entity:o,pageSize:v,queryPrefix:S,filters:g}),R={...A};g.forEach(I=>{const H=I.id;if(R[H]!==void 0)try{R[H]=JSON.parse(R[H])}catch{}});const q={...R,fields:k,limit:v,offset:R.offset?Number(R.offset):0},F=e.useData(k,q),B=e.columnAdapter||nt(o),V=Ke(o,E||[],B),re=e.getColumns&&E?e.getColumns(E):V;if(F.isError)throw F.error;const ne=async()=>{try{h!=null&&h.is_system_default?await O.mutateAsync({name:h.name||null,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}}):await T.mutateAsync({name:"Default",is_system_default:!0,set_active:!0,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}})}catch{}},se=async()=>{if(h)try{await O.mutateAsync({name:h.name,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}})}catch{}},ie=()=>{x(!0),C(null)},ae=d?c.jsxs(c.Fragment,{children:[c.jsx(X,{variant:"secondary",size:"small",type:"button",onClick:D,children:f("actions.clear")}),c.jsx(we,{isDefaultView:(h==null?void 0:h.is_system_default)||!h,currentViewId:h==null?void 0:h.id,currentViewName:h==null?void 0:h.name,onSaveAsDefault:ne,onUpdateExisting:se,onSaveAsNew:ie})]}):null;return c.jsxs(xe,{className:"divide-y p-0",children:[c.jsx(he,{data:F.data||[],columns:re,filters:g,getRowId:e.getRowId||(I=>I.id),rowCount:F.count,enablePagination:!0,enableSearch:!0,pageSize:v,isLoading:F.isLoading||j,layout:s,heading:t||l||(o?f(`${o}.domain`):""),subHeading:r,enableColumnVisibility:w,initialColumnVisibility:L,onColumnVisibilityChange:_,columnOrder:M,onColumnOrderChange:U,enableViewSelector:w,entity:o,currentColumns:N,filterBarContent:ae,rowHref:e.getRowHref,emptyState:e.emptyState||{empty:{heading:f(`${o}.list.noRecordsMessage`)}},prefix:S,actions:a,enableFilterMenu:!1}),u&&c.jsx(ye,{entity:o,currentColumns:N,currentConfiguration:y,editingView:m,onClose:()=>{x(!1),C(null)},onSaved:()=>{x(!1),C(null)}})]})}function _t(e){return{getRowId:t=>t.id,pageSize:20,queryPrefix:"",...e}}export{gt as C,_t as c,Xe as o,Ze as p};
