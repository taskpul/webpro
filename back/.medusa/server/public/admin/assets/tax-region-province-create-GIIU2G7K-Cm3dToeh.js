import{a as S}from"./chunk-EHAU7SOS-CLzxgcUB.js";import{P as E}from"./chunk-KEQOAJC2-Yj14g3dO.js";import{S as M}from"./chunk-D7H6ZNK4-DuqkGbL3.js";import{K as $}from"./chunk-6HTZNHPT-XB1WuBsp.js";import{R as x,u as L}from"./chunk-4TC5YS65-CQLRrj-3.js";import{r as v,b as I,j as e,aH as B,I as _,ap as w,ar as p,aD as H,as as z,ab as K,gf as V,aw as A,ax as D,ge as O,t as C,H as N,Z as T,W as o,X as y,af as W,c5 as X,B as F}from"./index-DdOSbXML.js";var P=v.forwardRef(({className:r,disabled:a,placeholder:m,country_code:t,valueAs:u="iso_2",...f},g)=>{var j;const{t:i}=I(),n=v.useRef(null);v.useImperativeHandle(g,()=>n.current);const b=((j=n.current)==null?void 0:j.value)==="",s=S(t);s||(a=!0);const h=Object.entries((s==null?void 0:s.options)??{}).map(([d,R])=>e.jsx("option",{value:u==="iso_2"?d:R,children:R},d)),c=s?i(`taxRegions.fields.sublevels.placeholders.${s.type}`):"",l=s?e.jsx("option",{value:"",disabled:!0,className:"text-ui-fg-muted",children:m||c}):null;return e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:_("text-ui-fg-muted transition-fg pointer-events-none absolute right-2 top-1/2 -translate-y-1/2",{"text-ui-fg-disabled":a})}),e.jsxs("select",{disabled:a,className:_("bg-ui-bg-field shadow-buttons-neutral transition-fg txt-compact-small flex w-full select-none appearance-none items-center justify-between rounded-md px-2 py-1.5 outline-none","placeholder:text-ui-fg-muted text-ui-fg-base","hover:bg-ui-bg-field-hover","focus-visible:shadow-borders-interactive-with-active data-[state=open]:!shadow-borders-interactive-with-active","aria-[invalid=true]:border-ui-border-error aria-[invalid=true]:shadow-borders-error","invalid::border-ui-border-error invalid:shadow-borders-error","disabled:!bg-ui-bg-disabled disabled:!text-ui-fg-disabled",{"text-ui-fg-muted":b},r),...f,ref:n,children:[l,h]})]})});P.displayName="CountrySelect";var Z=w({province_code:p().min(1),name:p().optional(),code:p().min(1),rate:w({float:H().optional(),value:p().optional()}).optional(),is_combinable:z().optional()}),k=({parent:r})=>{const{t:a}=I(),{handleSuccess:m}=L(),t=A({defaultValues:{province_code:"",code:"",is_combinable:!1,name:"",rate:{value:""}},resolver:D(Z)}),{mutateAsync:u,isPending:f}=O(),g=t.handleSubmit(async s=>{var c;const h=s.name&&((c=s.rate)!=null&&c.float)?{name:s.name,rate:s.rate.float,code:s.code,is_combinable:s.is_combinable}:void 0;await u({country_code:r.country_code,province_code:s.province_code,parent_id:r.id,default_tax_rate:h},{onSuccess:({tax_region:l})=>{C.success(a("taxRegions.create.successToast")),m(`/settings/tax-regions/${r.id}/provinces/${l.id}`)},onError:l=>{C.error(l.message)}})}),i=S(r.country_code),n=(i==null?void 0:i.type)||"sublevel",b=a(`taxRegions.fields.sublevels.labels.${n}`);return e.jsx(x.Form,{form:t,children:e.jsxs($,{onSubmit:g,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(x.Header,{}),e.jsx(x.Body,{className:"flex flex-1 flex-col overflow-hidden",children:e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-2 py-16",children:[e.jsxs("div",{children:[e.jsx(N,{children:a(`taxRegions.${n}.create.header`)}),e.jsx(T,{size:"small",className:"text-ui-fg-subtle",children:a(`taxRegions.${n}.create.hint`)})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.jsx(o.Field,{control:t.control,name:"province_code",render:({field:s})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{tooltip:!i&&a("taxRegions.fields.sublevels.tooltips.sublevel"),children:b}),e.jsx(o.Control,{children:i?e.jsx(P,{country_code:r.country_code,...s}):e.jsx(y,{...s,placeholder:"KR-26"})}),e.jsx(o.ErrorMessage,{})]})})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(N,{level:"h2",className:"!txt-compact-small-plus",children:a("taxRegions.fields.defaultTaxRate.label")}),e.jsxs(T,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:["(",a("fields.optional"),")"]}),e.jsx(W,{content:a("taxRegions.fields.defaultTaxRate.tooltip"),children:e.jsx(X,{className:"text-ui-fg-muted"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(o.Field,{control:t.control,name:"name",render:({field:s})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:a("fields.name")}),e.jsx(o.Control,{children:e.jsx(y,{...s})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:t.control,name:"rate",render:({field:{value:s,onChange:h,...c}})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:a("taxRegions.fields.taxRate")}),e.jsx(o.Control,{children:e.jsx(E,{...c,value:s==null?void 0:s.value,decimalsLimit:4,onValueChange:(l,j,d)=>h({value:l,float:d==null?void 0:d.float})})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:t.control,name:"code",render:({field:s})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:a("taxRegions.fields.taxCode")}),e.jsx(o.Control,{children:e.jsx(y,{...s})}),e.jsx(o.ErrorMessage,{})]})})]})]}),e.jsx(M,{control:t.control,name:"is_combinable",label:a("taxRegions.fields.isCombinable.label"),description:a("taxRegions.fields.isCombinable.hint")})]})})}),e.jsx(x.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(x.Close,{asChild:!0,children:e.jsx(F,{size:"small",variant:"secondary",children:a("actions.cancel")})}),e.jsx(F,{size:"small",type:"submit",isLoading:f,children:a("actions.save")})]})})]})})},ee=()=>{const{id:r}=K(),{tax_region:a,isPending:m,isError:t,error:u}=V(r),f=!m&&!!a;if(t)throw u;return e.jsx(x,{children:f&&e.jsx(k,{parent:a})})};export{ee as Component,ee as TaxProvinceCreate};
