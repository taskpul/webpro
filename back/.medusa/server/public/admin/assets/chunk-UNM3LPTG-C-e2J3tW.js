import{u as Pe}from"./chunk-C76H5USB-VyJ6cqJ4.js";import{b as de,d as ue,bm as se,r as d,an as ke,u as Oe,cy as Ie,j as e,cz as S,H as fe,Z as he,A as Le,B,L as Ke,g as Re,ai as re,bB as b,aJ as $e,P as qe,T as Be,t as L,cA as ze,cB as Je,cC as Ue,cD as Xe,cE as Qe,cF as Ye,aw as Ce,cr as v,$ as Ge,X as We,cG as Ze}from"./index-DdOSbXML.js";var z=(s,a)=>{let t=a;t||(s instanceof Ze||s.message?t=s.message:t="An error occurred"),L.error(t)},xe=s=>{const a=ue("view_configurations"),t=ze(s,{limit:100},{enabled:a&&!!s}),n=Je(s,{enabled:a&&!!s}),c=Ue(s,{onSuccess:()=>{L.success("View created")},onError:j=>{z(j,"Failed to create view")}}),h=Xe(s,{onSuccess:()=>{},onError:j=>{z(j,"Failed to update active view")}});return d.useMemo(()=>({isViewConfigEnabled:a,listViews:t,activeView:n,createView:c,setActiveView:h,isDefaultViewActive:(n==null?void 0:n.is_default_active)??!0}),[a,t,n,c,h])},me=(s,a)=>{const t=Qe(s,a,{onSuccess:()=>{L.success("View updated")},onError:c=>{z(c,"Failed to update view")}}),n=Ye(s,a,{onSuccess:()=>{L.success("View deleted successfully")},onError:c=>{z(c,"Failed to delete view")}});return{updateView:t,deleteView:n}},He=({entity:s,currentColumns:a,currentConfiguration:t,editingView:n,onClose:c,onSaved:h})=>{const{createView:j}=xe(s),{updateView:D}=me(s,(n==null?void 0:n.id)||""),[P,p]=d.useState(!1),{register:T,handleSubmit:A,formState:{errors:w}}=Ce({defaultValues:{name:(n==null?void 0:n.name)||""}}),u=async f=>{if(f.name.trim()){p(!0);try{if(n){const g=await D.mutateAsync({name:f.name.trim(),configuration:{visible_columns:(a==null?void 0:a.visible)||n.configuration.visible_columns,column_order:(a==null?void 0:a.order)||n.configuration.column_order,filters:(t==null?void 0:t.filters)||n.configuration.filters||{},sorting:(t==null?void 0:t.sorting)||n.configuration.sorting||null,search:(t==null?void 0:t.search)||n.configuration.search||""}});h(g.view_configuration)}else{const g=await j.mutateAsync({name:f.name.trim(),set_active:!0,configuration:{visible_columns:(a==null?void 0:a.visible)||[],column_order:(a==null?void 0:a.order)||[],filters:(t==null?void 0:t.filters)||{},sorting:(t==null?void 0:t.sorting)||null,search:(t==null?void 0:t.search)||""}});h(g.view_configuration)}}catch{}finally{p(!1)}}};return e.jsx(v,{open:!0,onOpenChange:c,children:e.jsxs(v.Content,{className:"flex flex-col",children:[e.jsxs(v.Header,{children:[e.jsx(v.Title,{asChild:!0,children:e.jsx(fe,{children:n?"Edit View Name":"Save as New View"})}),e.jsx(v.Description,{asChild:!0,children:e.jsx(he,{children:n?"Change the name of your saved view":"Save your current configuration as a new view"})})]}),e.jsxs("form",{onSubmit:A(u),className:"flex flex-1 flex-col",children:[e.jsx(v.Body,{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(Ge,{htmlFor:"name",weight:"plus",children:"View Name"}),e.jsx(We,{...T("name",{required:"Name is required",validate:f=>f.trim().length>0||"Name cannot be empty"}),type:"text",placeholder:"Enter view name",autoFocus:!0}),w.name&&e.jsx("span",{className:"text-sm text-ui-fg-error",children:w.name.message})]})}),e.jsxs(v.Footer,{children:[e.jsx(v.Close,{asChild:!0,children:e.jsx(B,{variant:"secondary",size:"small",type:"button",children:"Cancel"})}),e.jsx(B,{variant:"primary",size:"small",type:"submit",isLoading:P,children:n?"Update":"Save"})]})]})]})})},es=({entity:s,currentColumns:a,currentConfiguration:t})=>{const{listViews:n,activeView:c,setActiveView:h,isDefaultViewActive:j}=xe(s),D=(n==null?void 0:n.view_configurations)||[],[P,p]=d.useState(!1),[T,A]=d.useState(null),[w,u]=d.useState(null),[f,g]=d.useState({x:0,y:0}),[r,y]=d.useState(null),K=Re(),k=(c==null?void 0:c.view_configuration)||null,{deleteView:O}=me(s,r||""),R=async l=>{try{if(l===null){await h.mutateAsync(null);return}D.find(Q=>Q.id===l)&&await h.mutateAsync(l)}catch(m){console.error("Error in handleViewSelect:",m)}},J=async l=>{await K({title:"Delete view",description:`Are you sure you want to delete "${l.name}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel"})&&y(l.id)};d.useEffect(()=>{r&&O.mutateAsync&&O.mutateAsync().then(()=>{y(null)}).catch(()=>{y(null)})},[r,O.mutateAsync]);const _=l=>{A(l),p(!0)},F=async l=>{await K({title:"Reset system default",description:"This will delete the saved system default and revert to the original code-level defaults. All users will be affected. Are you sure?",confirmText:"Reset",cancelText:"Cancel"})&&y(l.id)},M=D.find(l=>l.is_system_default),I=D.filter(l=>!l.is_system_default),U=j;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx(re,{color:U?"blue":"grey",size:"xsmall",className:"cursor-pointer",onClick:()=>R(null),onContextMenu:l=>{l.preventDefault(),M&&(g({x:l.clientX,y:l.clientY}),u("default"))},children:"Default"}),M&&w==="default"&&e.jsxs(b,{open:!0,onOpenChange:l=>{l||u(null)},children:[e.jsx(b.Trigger,{asChild:!0,children:e.jsx("div",{style:{position:"fixed",left:f.x,top:f.y,width:0,height:0}})}),e.jsx(b.Content,{align:"start",sideOffset:0,children:e.jsxs(b.Item,{onClick:()=>{F(M),u(null)},className:"flex items-center gap-x-2",children:[e.jsx($e,{className:"text-ui-fg-subtle"}),e.jsx("span",{children:"Reset to code defaults"})]})})]})]}),I.length>0&&e.jsx("div",{className:"text-ui-fg-muted",children:"|"}),I.map(l=>e.jsxs("div",{className:"relative inline-block",children:[e.jsx(re,{color:(k==null?void 0:k.id)===l.id?"blue":"grey",size:"xsmall",className:"cursor-pointer",onClick:()=>R(l.id),onContextMenu:m=>{m.preventDefault(),g({x:m.clientX,y:m.clientY}),u(l.id)},children:l.name}),w===l.id&&e.jsxs(b,{open:!0,onOpenChange:m=>{m||u(null)},children:[e.jsx(b.Trigger,{asChild:!0,children:e.jsx("div",{style:{position:"fixed",left:f.x,top:f.y,width:0,height:0}})}),e.jsxs(b.Content,{align:"start",sideOffset:0,children:[e.jsxs(b.Item,{onClick:()=>{_(l),u(null)},className:"flex items-center gap-x-2",children:[e.jsx(qe,{className:"text-ui-fg-subtle"}),e.jsx("span",{children:"Edit name"})]}),e.jsxs(b.Item,{onClick:()=>{J(l),u(null)},className:"flex items-center gap-x-2 text-ui-fg-error",children:[e.jsx(Be,{}),e.jsx("span",{children:"Delete"})]})]})]})]},l.id))]}),P&&e.jsx(He,{entity:s,currentColumns:a,currentConfiguration:t,editingView:T,onClose:()=>{p(!1),A(null)},onSaved:async l=>{p(!1),A(null),L.success(`View "${l.name}" saved successfully`)}})]})},us=({data:s=[],columns:a,filters:t,commands:n,action:c,actions:h,actionMenu:j,getRowId:D,rowCount:P=0,enablePagination:p=!0,enableSearch:T=!0,autoFocusSearch:A=!1,enableFilterMenu:w,rowHref:u,heading:f,subHeading:g,prefix:r,pageSize:y=10,emptyState:K,rowSelection:k,isLoading:O=!1,layout:R="auto",enableColumnVisibility:J=!1,initialColumnVisibility:_={},onColumnVisibilityChange:F,columnOrder:M,onColumnOrderChange:I,enableViewSelector:U=!1,entity:X,currentColumns:l,filterBarContent:m})=>{const{t:Q}=de(),te=ue("view_configurations"),ae=te&&J,je=te&&U,ne=t&&t.length>0,pe=w!==void 0?w:ne,be=n&&n.length>0,Y=a.some(i=>i.enableSorting),[C,le]=se.useState(_);se.useEffect(()=>{const i=Object.keys(C).sort(),o=Object.keys(_).sort();(i.length!==o.length||i.some((E,V)=>E!==o[V])||Object.entries(_).some(([E,V])=>C[E]!==V))&&le(_)},[_]);const we=se.useCallback(i=>{le(i),F==null||F(i)},[F]),$=d.useMemo(()=>(t==null?void 0:t.map(i=>i.id))??[],[t]),ye=$.map(i=>N(i,r)),{offset:G,order:W,q:ie,...oe}=Pe([...$,...Y?["order"]:[],...T?["q"]:[],...p?["offset"]:[]],r),[cs,q]=ke(),Z=d.useMemo(()=>ie??"",[ie]),Se=i=>{q(o=>(i?o.set(N("q",r),i):o.delete(N("q",r)),o))},ve=d.useMemo(()=>G?ns(G,y):{pageIndex:0,pageSize:y},[G,y]),Ne=i=>{q(o=>(i.pageIndex===0?o.delete(N("offset",r)):o.set(N("offset",r),as(i).toString()),o))},H=d.useMemo(()=>ls($,oe),[$,oe]),De=i=>{q(o=>(Array.from(o.keys()).forEach(x=>{ye.includes(x)&&((r?x.replace(`${r}_`,""):x)in i||o.delete(x))}),Object.entries(i).forEach(([x,E])=>{const V=N(x,r);E!==void 0?o.set(V,JSON.stringify(E)):o.delete(V)}),o))},ee=d.useMemo(()=>W?ts(W):null,[W]),Te=d.useMemo(()=>({filters:H,sorting:ee,search:Z}),[H,ee,Z]),Ae=i=>{q(o=>{if(i){const x=ss(i);o.set(N("order",r),x)}else o.delete(N("order",r));return o})},{pagination:_e,toolbar:Ee}=is(),ce=Oe(),Fe=d.useCallback((i,o)=>{if(!u)return;const x=u(o);if(i.metaKey||i.ctrlKey||i.button===1){window.open(x,"_blank","noreferrer");return}if(i.shiftKey){window.open(x,void 0,"noreferrer");return}ce(x)},[ce,u]),Me=Ie({data:s,columns:a,filters:t,commands:n,rowCount:P,getRowId:D,onRowClick:u?Fe:void 0,pagination:p?{state:ve,onPaginationChange:Ne}:void 0,filtering:ne?{state:H,onFilteringChange:De}:void 0,sorting:Y?{state:ee,onSortingChange:Ae}:void 0,search:T?{state:Z,onSearchChange:Se}:void 0,rowSelection:k,isLoading:O,columnVisibility:ae?{state:C,onColumnVisibilityChange:we}:void 0,columnOrder:ae&&M&&I?{state:M,onColumnOrderChange:I}:void 0}),Ve=f||g;return e.jsxs(S,{instance:Me,className:R==="fill"?"h-full [&_tr]:last-of-type:!border-b":void 0,children:[e.jsx(S.Toolbar,{className:"flex flex-col items-start justify-between gap-2 md:flex-row md:items-center",translations:Ee,filterBarContent:m,children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-x-4",children:[Ve&&e.jsxs("div",{children:[f&&e.jsx(fe,{children:f}),g&&e.jsx(he,{size:"small",className:"text-ui-fg-subtle",children:g})]}),je&&X&&e.jsx(es,{entity:X,currentColumns:l,currentConfiguration:Te})]}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[pe&&e.jsx(S.FilterMenu,{}),Y&&e.jsx(S.SortingMenu,{}),T&&e.jsx("div",{className:"w-full md:w-auto",children:e.jsx(S.Search,{placeholder:Q("filters.searchLabel"),autoFocus:A})}),j&&e.jsx(Le,{variant:"primary",...j}),h&&h.length>0&&e.jsx(os,{actions:h}),!h&&c&&e.jsx(ge,{...c})]})]})}),e.jsx(S.Table,{emptyState:K}),p&&e.jsx(S.Pagination,{translations:_e}),be&&e.jsx(S.CommandBar,{selectedLabel:i=>`${i} selected`})]})};function ss(s){return s.desc?`-${s.id}`:s.id}function ts(s){return s.startsWith("-")?{id:s.slice(1),desc:!0}:{id:s,desc:!1}}function as(s){return s.pageIndex*s.pageSize}function ns(s,a){const t=parseInt(s);return{pageIndex:Math.floor(t/a),pageSize:a}}function ls(s,a){if(!a)return{};const t={};for(const n of s){const c=a[n];c!==void 0&&(t[n]=JSON.parse(c))}return t}function N(s,a){return a?`${a}_${s}`:s}var is=()=>{const{t:s}=de(),a={of:s("general.of"),results:s("general.results"),pages:s("general.pages"),prev:s("general.prev"),next:s("general.next")},t={clearAll:s("actions.clearAll"),sort:s("filters.sortLabel"),columns:"Columns"};return{pagination:a,toolbar:t}},ge=({label:s,disabled:a,...t})=>{const n={size:"small",disabled:a??!1,type:"button",variant:"secondary"};return"to"in t?e.jsx(B,{...n,asChild:!0,children:e.jsx(Ke,{to:t.to,children:s})}):e.jsx(B,{...n,onClick:t.onClick,children:s})},os=({actions:s})=>e.jsx("div",{className:"flex items-center gap-x-2",children:s.map((a,t)=>e.jsx(ge,{...a},t))});export{us as D,He as S,me as a,xe as u};
