import{a as E}from"./chunk-UC26CCHZ-DbXuoyCH.js";import{S as F}from"./chunk-PYIO3TDQ-D8Zv8hXV.js";import{f as T}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{u as y}from"./chunk-HFB3OQXI-CgJWO1Kt.js";import{C as j}from"./chunk-2PMSBTXI-B-DQ21hS.js";import{S as V}from"./chunk-D7H6ZNK4-DuqkGbL3.js";import{K as I}from"./chunk-6HTZNHPT-XB1WuBsp.js";import{b as m,u as w}from"./chunk-4TC5YS65-CQLRrj-3.js";import{ap as N,ar as h,ex as P,as as O,b as L,ab as B,aV as M,j as e,H as R,s as v,aw as $,ax as q,t as S,W as s,X as z,V as D,B as C}from"./index-DdOSbXML.js";import{u as K,c as H}from"./chunk-GRT22PE5-Bh_4tQNx.js";import{R as b}from"./radio-group-bYQ_4UAu.js";import"./index-B-otT4yT.js";function A(p,n){const a={};return n.forEach(o=>{o in p&&(a[o]=p[o])}),a}var G=N({name:h().min(1),price_type:P(F),enabled_in_store:O().optional(),shipping_profile_id:h(),shipping_option_type_id:h(),provider_id:h().optional()}),U=({locationId:p,shippingOption:n,type:a})=>{const{t:o}=L(),{handleSuccess:u}=w(),x=a==="pickup",c=y({queryFn:i=>v.admin.shippingProfile.list(i),queryKey:["shipping_profiles"],getOptions:i=>i.shipping_profiles.map(t=>({label:t.name,value:t.id})),defaultValue:n.shipping_profile_id}),d=y({queryFn:i=>v.admin.shippingOptionType.list(i),queryKey:["shipping_option_types"],getOptions:i=>i.shipping_option_types.map(t=>({label:t.label,value:t.id}))}),r=$({defaultValues:{name:n.name,price_type:n.price_type,enabled_in_store:E(n),shipping_profile_id:n.shipping_profile_id,shipping_option_type_id:n.type.id,provider_id:n.provider_id},resolver:q(G)}),{mutateAsync:f,isPending:_}=H(n.id),k=r.handleSubmit(async i=>{const t=n.rules.map(l=>({...A(l,["id","attribute","operator","value"])})),g=t.find(l=>l.attribute==="enabled_in_store");g?g.value=i.enabled_in_store?"true":"false":t.push({value:i.enabled_in_store?"true":"false",attribute:"enabled_in_store",operator:"eq"}),await f({name:i.name,price_type:i.price_type,shipping_profile_id:i.shipping_profile_id,rules:t,type_id:i.shipping_option_type_id},{onSuccess:({shipping_option:l})=>{S.success(o("stockLocations.shippingOptions.edit.successToast",{name:l.name})),u(`/settings/locations/${p}`)},onError:l=>{S.error(l.message)}})});return e.jsx(m.Form,{form:r,children:e.jsxs(I,{onSubmit:k,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(m.Body,{className:"overflow-y-auto",children:e.jsx("div",{className:"flex flex-col gap-y-8",children:e.jsxs("div",{className:"flex flex-col gap-y-8",children:[!x&&e.jsx(s.Field,{control:r.control,name:"price_type",render:({field:i})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:o("stockLocations.shippingOptions.fields.priceType.label")}),e.jsx(s.Control,{children:e.jsxs(b,{...i,onValueChange:i.onChange,children:[e.jsx(b.ChoiceBox,{className:"flex-1",value:"flat",label:o("stockLocations.shippingOptions.fields.priceType.options.fixed.label"),description:o("stockLocations.shippingOptions.fields.priceType.options.fixed.hint")}),e.jsx(b.ChoiceBox,{className:"flex-1",value:"calculated",label:o("stockLocations.shippingOptions.fields.priceType.options.calculated.label"),description:o("stockLocations.shippingOptions.fields.priceType.options.calculated.hint")})]})}),e.jsx(s.ErrorMessage,{})]})}),e.jsxs("div",{className:"grid gap-y-4",children:[e.jsx(s.Field,{control:r.control,name:"name",render:({field:i})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:o("fields.name")}),e.jsx(s.Control,{children:e.jsx(z,{...i})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:r.control,name:"shipping_profile_id",render:({field:i})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:o("stockLocations.shippingOptions.fields.profile")}),e.jsx(s.Control,{children:e.jsx(j,{...i,options:c.options,searchValue:c.searchValue,onSearchValueChange:c.onSearchValueChange,disabled:c.disabled})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:r.control,name:"shipping_option_type_id",render:({field:i})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:o("stockLocations.shippingOptions.fields.type")}),e.jsx(s.Control,{children:e.jsx(j,{...i,options:d.options,searchValue:d.searchValue,onSearchValueChange:d.onSearchValueChange,disabled:d.disabled})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:r.control,name:"provider_id",disabled:!0,render:({field:i})=>{var t;return e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:o("stockLocations.shippingOptions.fields.provider")}),e.jsx(s.Control,{children:e.jsx(j,{value:n.provider_id,disabled:!0,options:[{label:`${T(n.provider_id)} (${((t=n==null?void 0:n.data)==null?void 0:t.id)||"N/A"})`,value:n.provider_id}]})}),e.jsx(s.ErrorMessage,{})]})}})]}),e.jsx(D,{}),e.jsx(V,{control:r.control,name:"enabled_in_store",label:o("stockLocations.shippingOptions.fields.enableInStore.label"),description:o("stockLocations.shippingOptions.fields.enableInStore.hint")})]})})}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(C,{size:"small",variant:"secondary",children:o("actions.cancel")})}),e.jsx(C,{size:"small",type:"submit",isLoading:_,children:o("actions.save")})]})})]})})},te=()=>{const{t:p}=L(),{location_id:n,so_id:a}=B(),{shipping_options:o,isPending:u,isFetching:x,isError:c,error:d}=K({id:a,fields:"+service_zone.fulfillment_set.type"}),r=o==null?void 0:o.find(_=>_.id===a);if(!u&&!x&&!r)throw M({message:`Shipping option with ID ${a} was not found`},404);if(c)throw d;const f=(r==null?void 0:r.service_zone.fulfillment_set.type)==="pickup";return e.jsxs(m,{children:[e.jsx(m.Header,{children:e.jsx(R,{children:p(`stockLocations.${f?"pickupOptions":"shippingOptions"}.edit.header`)})}),r&&e.jsx(U,{shippingOption:r,locationId:n,type:r.service_zone.fulfillment_set.type})]})};export{te as Component};
